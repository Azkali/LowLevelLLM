repos:
  - repo: local
    hooks:
      - id: run
        name: Run tests
        entry: >
          bash -c '
          if [[ $SKIP_PRECOMMIT = "true" ]]; then
            echo "Skipping pre-commit hook"
            exit 0
          fi

          case $(uname -s) in
            "Linux")
              if grep -rlq "0x1002" /sys/bus/pci/devices/*/vendor 2>/dev/null; then
                echo "AMD GPU detected — running ROCm container"
                docker build -f Dockerfile.rocm -t supercharger/rocm .
                docker run --rm --privileged supercharger/rocm --json /app/examples/prompts/text_xform.json --model xformLLM
              else
                echo "Running Vulkan container"
                make vulkan
              fi
              ;;
            "Darwin")
              echo "Running on macOS — running uv locally"
              make metal
              ;;
            *)
              echo "Running on CPU — running uv locally"
              make cpu
              ;;
          esac
          '
        language: system
        pass_filenames: false
        always_run: true
        verbose: true
